<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <script src="../js/sessao.js"></script>
  <title>Filmes | GavaMotors</title>
</head>

<body onload="validarSessao()">
  <div class="menu-lateral">
    <img src="../assets/imgs/Logo-GavaMotors-White.png" alt="" />
    <p class="bem-vindo">Olá, <span id="b_usuario">usuário</span></p>
    <div class="botoes-menu">
      <a href="dashboard.html"><button>Dashboard</button></a>
      <a href="carros.html"><button>Carros</button></a>
      <a href="filmes.html"><button id="filmes-btn">Filmes</button></a>
      <a href="jogos.html"><button>Jogos</button></a>
    </div>
    <a href=""><button onclick="limparSessao()" class="btn-sair">Sair</button></a>
  </div>
  <div class="main-section-filmes">
    <div class="section-filmes">
      <div class="card-filmes"></div>
      <div class="card-filmes"></div>
      <div class="card-filmes"></div>
      <div class="card-filmes"></div>
      <div class="card-filmes"></div>
      <div class="card-filmes"></div>
      <div class="card-filmes"></div>
      <div class="card-filmes"></div>
      <div class="card-filmes"></div>
    </div>
  </div>
</body>

</html>

<script>
  b_usuario.innerHTML = sessionStorage.NOME_USUARIO;


  imagensFundo = [
    "../assets/imgs/img-filmes/filmes-SpeedRacer.png",
    "../assets/imgs/img-filmes/filmes-Carros.png",
    "../assets/imgs/img-filmes/filmes-Carros2.png",
    "../assets/imgs/img-filmes/filmes-Carros3.png",
    "../assets/imgs/img-filmes/filmes-Velozes_e_Furiosos.png",
    "../assets/imgs/img-filmes/filmes-Velozes_e_Furiosos2.png",
    "../assets/imgs/img-filmes/filmes-Velozes_e_Furiosos-Tokyo.png",
    "../assets/imgs/img-filmes/filmes-Velozes_e_Furiosos4.png",
    "../assets/imgs/img-filmes/filmes-Velozes_e_Furiosos5.png"
  ];

  var nomeFilmes = [
    "SpeedRacer",
    "Carros",
    "Carros 2",
    "Carros 3",
    "Velozes e Furiosos",
    "Velozes e Furiosos 2",
    "Velozes e Furiosos - Tokyo",
    "Velozes e Furiosos 4",
    "Velozes e Furiosos 5"];

  var anoLancamentoFilmes = [
    '2008',
    '2006',
    '2011',
    '2017',
    '2001',
    '2003',
    '2006',
    '2009',
    '2011'
  ]

  var descricaoDosFilmes = [
    "Piloto de corridas enfrenta desafios em competições de alta velocidade com seu carro especial.",
    "Relâmpago McQueen descobre amizade e humildade em uma pequena cidade após acidente inesperado.",
    "Relâmpago McQueen e Mate participam de um campeonato mundial de corridas com espionagem internacional.",
    "Relâmpago McQueen enfrenta novos corredores e busca provar que ainda é competitivo.",
    "Piloto de rua e policial infiltrado enfrentam crimes e corridas ilegais em Los Angeles.",
    "Brian O'Conner e amigo se unem para derrubar um traficante de drogas em Miami.",
    "Jovem piloto americano se envolve no mundo das corridas de drift em Tóquio.",
    "Dominic Toretto e Brian O'Conner reúnem-se para combater um traficante de drogas.",
    "Grupo de corredores planeja um grande assalto no Brasil enquanto foge das autoridades."
  ]

  const cards = document.querySelectorAll(".card-filmes");

  // Loop através dos cards e define o background para cada um
  for (var i = 0; i < cards.length && i < imagensFundo.length; i++) {
    cards[i].style.backgroundImage = `url(${imagensFundo[i]})`;

    let cardContent = document.createElement("div");
    cardContent.className = "card-filmes-content";
    cardContent.id = `card-filmes-content-${[i]}`;

    let tituloCard = document.createElement("h1");
    tituloCard.className = "titulo-card-filmes";
    tituloCard.textContent = nomeFilmes[i];

    let descricaoFilmes = document.createElement("p");
    descricaoFilmes.className = "descricao-filmes";
    descricaoFilmes.textContent = descricaoDosFilmes[i];

    let anoLancamento = document.createElement("h4");
    anoLancamento.className = "ano-lancamento";
    anoLancamento.textContent = `Ano de Lançamento: ${anoLancamentoFilmes[i]}`;

    cardContent.appendChild(tituloCard);

    let cardDescricaoFilme = document.createElement("div");
    cardDescricaoFilme.className = "card-descricao-jogos";

    cardDescricaoFilme.appendChild(descricaoFilmes);
    cardDescricaoFilme.appendChild(anoLancamento);

    cardContent.appendChild(cardDescricaoFilme);

    let button = document.createElement("button");
    button.className = "btn-assisti";
    button.id = i + 1;
    button.textContent = "Já assisti!";

    button.onclick = enviarDadoProBanco;

    cardContent.appendChild(button);
    cards[i].appendChild(cardContent);

    // Adiciona eventos de mouse ao card
    cards[i].addEventListener("mouseenter", function () {
      cardContent.classList.add("show");
    });

    cards[i].addEventListener("mouseleave", function () {
      cardContent.classList.remove("show");
    });
  }

  function inserirDadoNoBanco(id) {
    console.log(`Inserir no banco: ${id} e ${sessionStorage.ID_USUARIO}`);
    // Lógica para inserir no banco de dados
    fetch("/likes/adicionarLikeFilmes", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/likes.js
        usuarioID: sessionStorage.ID_USUARIO,
        like: id
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
        if (resposta.ok) {
          console.log("Like Inserido no banco de dados.")
        } else {
          throw "Houve um erro ao tentar adicionar o like!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
    return false;
  }



  function removerDadoDoBanco(id) {
    console.log(`Remover do banco: ${id} e ${sessionStorage.ID_USUARIO}`);
    // Lógica para inserir no banco de dados
    fetch("/likes/removerLikeFilmes", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/likes.js
        usuarioID: sessionStorage.ID_USUARIO,
        like: id
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
        if (resposta.ok) {
          console.log("Like Removido no banco de dados.")
        } else {
          throw "Houve um erro ao tentar remover o like!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
    return false;
  }


  // Função para enviar dado para o banco e alternar a cor do botão
  function enviarDadoProBanco(event) {
    const button = event.target;
    const buttonId = button.id;

    if (button.classList.contains("btn-joguei-on")) {
      // Botão está atualmente ligado, então desativar e remover do banco
      button.classList.remove("btn-joguei-on");
      removerDadoDoBanco(buttonId);
    } else {
      // Botão está atualmente desligado, então ativar e inserir no banco
      button.classList.add("btn-joguei-on");
      inserirDadoNoBanco(buttonId);
    }
  }
</script>